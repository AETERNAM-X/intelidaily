<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InteliDaily</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        },
        startup: {
          pageReady: () => {
            return MathJax.startup.defaultPageReady().then(() => {
              console.log('MathJax inicializado com sucesso');
            });
          }
        }
      };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .question-image { max-width: 100%; height: auto; margin: 10px 0; }
        .image-container { flex: 1; min-width: 200px; text-align: center; }
        .image-caption { font-size: 12px; color: #666; margin-top: 5px; }

        /* Cabeçalho como card branco */
        .header-rect {
            background: #ffffff;
            border-bottom: 1px solid #e6e6e6;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        /* ----- PROGRESS BAR: linha única e nós centrados ----- */
        /* adicionei apenas a classe `progress-row` no container dos blocos (HTML) e uso este CSS para alinhar */
        .progress-row { position: relative; max-width: 600px; margin: 0 auto; padding: 8px 0; }
        .progress-row::before {
            /* linha de progresso que passa por trás dos nós */
            content: "";
            position: absolute;
            left: 12px;
            right: 12px;
            top: calc(6px + 12px); /* ajusta verticalmente para ficar atrás dos círculos */
            height: 2px;
            background-color: #e5e7eb; /* gray-300 */
            z-index: 1;
        }
        .progress-row .flex {
            position: relative;
            z-index: 2; /* garante que os nós fiquem acima da linha */
            display:flex;
            justify-content: space-between;
            width:100%;
            gap:0;
        }
        .progress-node { display:flex; flex-direction:column; align-items:center; width:64px; } /* mantém espaço consistente */
        .progress-node .dot {
            width: 24px;
            height: 24px;
            border-radius: 9999px;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:12px;
            color:#fff;
            box-shadow: 0 1px 2px rgba(0,0,0,0.06);
        }
        .progress-node .dot.active { background:#FF3B3B; }
        .progress-node .dot.inactive { background:#9CA3AF; } /* gray */
        .progress-node .label { margin-top:6px; font-size:12px; color:#6B7280; font-weight:600; text-align:center; }

        /* Skip label menor (mantive a sua classe .skip-badge para compatibilidade) */
        .skip-badge { background:#FFF3CD; color:#856404; font-weight:700; border-radius:6px; padding:6px 10px; display:inline-flex; align-items:center; gap:8px; font-size:0.75rem; }

        /* Toggle styles (copiado do snippet que você mostrou) */
        .toggle-switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .toggle-input { opacity: 0; width: 0; height: 0; position: absolute; }
        .toggle-label { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #e5e7eb; transition: .25s; border-radius: 999px; }
        .toggle-label::before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .25s; border-radius: 50%; box-shadow: 0 2px 6px rgba(0,0,0,0.08); }
        .toggle-input:checked + .toggle-label { background-color: #3B4151; }
        .toggle-input:checked + .toggle-label::before { transform: translateX(20px); }

        /* disabled state for navigation before exam starts */
        .nav-disabled { pointer-events: none; opacity: 0.45; }
        button[disabled] { opacity: 0.45; cursor: not-allowed; }



        @media (max-width:720px) {
            .header-rect { flex-direction: column; gap: 12px; }
            .progress-row { max-width:100%; padding:12px 8px; }
            .progress-node { width: 22%; } /* ajuste para mobile */
        }
    </style>
</head>
<body class="bg-[#F8F8F8] min-h-screen flex flex-col justify-between">

    <!-- ===== HEADER (fixo no topo e 100% largura) ===== -->
    <header class="header-rect fixed top-0 left-0 w-full z-50">
        <div class="max-w-[900px] mx-auto flex items-center justify-between px-6 py-4">
            <div class="flex items-center space-x-2">
                <span class="text-gray-800 font-bold text-3xl select-none">InteliDaily</span>
            </div>

            <div class="flex flex-col items-center space-y-1">
                <div class="bg-[#3B4151] text-white text-xs font-semibold rounded px-2 py-[2px] select-none">
                    Início da prova remota: <span class="font-mono" id="start-time">--:--:--</span>
                </div>
                <div class="text-xs text-gray-600 select-none">Tempo para encerrar a prova:</div>
                <div class="font-mono font-semibold text-xl text-gray-900 select-none" id="timer">02:00:00</div>
            </div>

            <div class="flex items-center gap-3">
                <button id="start-exam-btn"
                    class="bg-[#3B4151] text-white text-sm font-semibold rounded px-4 py-2 select-none hover:bg-[#2a2e3d] transition"
                    type="button">Iniciar Prova</button>
                <button id="end-exam-btn"
                    class="bg-[#FF3B3B] text-white text-sm font-semibold rounded px-4 py-2 select-none hover:bg-[#e03232] transition hidden"
                    type="button">Encerrar prova</button>
            </div>
        </div>
    </header>

    <!-- Container principal (com padding-top para não ficar escondido atrás do header fixo) -->
    <div class="max-w-[900px] mx-auto w-full flex flex-col px-4 pt-32 pb-10">

        <!-- ===== Progress bar ===== -->
<section class="mb-6">
<div class="flex items-center justify-between max-w-[600px] mx-auto relative">
  <!-- Linha de fundo (fica atrás) -->
  <div class="absolute top-3 left-0 right-0 mx-auto w-11/12 h-[2px] bg-gray-300 z-0"></div>

  <!-- Bloco 1 -->
  <div class="flex flex-col items-center z-10">
    <div id="block-1"
      class="w-6 h-6 flex items-center justify-center rounded-full bg-[#FF3B3B] text-white text-xs font-bold">
      1
    </div>
    <span class="text-xs font-semibold text-[#FF3B3B] mt-1">Bloco 1</span>
  </div>

  <!-- Bloco 2 -->
  <div class="flex flex-col items-center z-10">
    <div id="block-2"
      class="w-6 h-6 flex items-center justify-center rounded-full bg-gray-400 text-white text-xs font-bold">
      2
    </div>
    <span class="text-xs font-semibold text-gray-600 mt-1">Bloco 2</span>
  </div>

  <!-- Bloco 3 -->
  <div class="flex flex-col items-center z-10">
    <div id="block-3"
      class="w-6 h-6 flex items-center justify-center rounded-full bg-gray-400 text-white text-xs font-bold">
      3
    </div>
    <span class="text-xs font-semibold text-gray-600 mt-1">Bloco 3</span>
  </div>

  <!-- Bloco 4 -->
  <div class="flex flex-col items-center z-10">
    <div id="block-4"
      class="w-6 h-6 flex items-center justify-center rounded-full bg-gray-400 text-white text-xs font-bold">
      4
    </div>
    <span class="text-xs font-semibold text-gray-600 mt-1">Bloco 4</span>
  </div>
</div>
</section>

        <!-- ===== Question navigation and finalize button ===== -->
        <section class="flex flex-wrap items-center justify-between w-full max-w-[900px] mx-auto mb-6">
            <div class="flex items-center space-x-2">
                <div class="flex items-center space-x-1 nav-disabled" id="question-nav">
                    <!-- question bullets inserted by script.js -->
                </div>
                <div class="bg-[#3B4151] text-white text-xs font-semibold rounded px-2 py-1 select-none" style="min-width: 90px" id="answered-count-container">Questões respondidas: <span class="font-bold" id="answered-count">0</span></div>
            </div>

            <button id="finalize-block-btn" class="bg-[#FF3B3B] text-white text-xs font-semibold rounded px-4 py-2 select-none whitespace-nowrap" type="button" disabled>Finalizar Bloco 1</button>
        </section>

        <!-- ===== Question content ===== -->
        <section id="question-content" class="mb-6 max-w-[900px] mx-auto bg-white rounded-md p-6 shadow-sm">
            <h2 class="text-gray-900 font-semibold text-base mb-3 select-none" id="question-title">Questão 01</h2>
            <div class="text-gray-600 text-xs leading-relaxed mb-6 select-text" id="question-text"><!-- Question text will be loaded here --></div>
            <div id="question-images" class="mb-6"><!-- Images will be displayed here --></div>
        </section>

        <!-- Answers -->
        <section id="answer-section" class="max-w-[900px] mx-auto bg-white rounded-md p-6 shadow-sm mb-6">
            <h3 class="text-gray-900 font-semibold text-sm mb-4 select-none">Resposta</h3>
            <form class="space-y-4 text-xs text-gray-700 select-none" id="answer-form"><!-- Answer options will be generated here --></form>

<div class="mt-6">
  <label class="skip-badge cursor-pointer select-none" for="skip-toggle">
    <div class="toggle-switch">
      <input type="checkbox" id="skip-toggle" class="toggle-input" />
      <span class="toggle-label"></span>
    </div>
    <span>Não quero responder esta questão</span>
  </label>
</div>
        </section>

        <!-- Next button -->
        <div class="flex justify-end max-w-[900px] mx-auto">
            <button id="next-btn" class="bg-[#3B4151] text-white text-xs font-semibold rounded px-4 py-2 flex items-center space-x-1 select-none hover:bg-[#2a2e3d] transition" type="button" disabled>
                <span>Próximo</span>
                <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>



    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        // Sistema de simulados - verificar se há simulado ativo (sem modificar UI)
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Verificar se há simulado ativo na sessão
                const response = await fetch('/api/simulados/current');
                if (!response.ok) {
                    // Se não há simulado ativo, redirecionar para dashboard
                    console.log('Nenhum simulado ativo, redirecionando para dashboard...');
                    window.location.href = '/';
                }
            } catch (error) {
                console.error('Erro ao verificar simulado:', error);
                window.location.href = '/';
            }
        });
    </script>
</body>
</html>