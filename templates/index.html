<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InteliDaily</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="icon" href="icone.webp" type="image/webp">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .question-image { max-width: 100%; height: auto; margin: 10px 0; }
        .image-container { flex: 1; min-width: 200px; text-align: center; }
        .image-caption { font-size: 12px; color: #666; margin-top: 5px; }

        /* Cabeçalho como card branco */
        .header-rect {
            background: #ffffff;
            border-bottom: 1px solid #e6e6e6;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        /* ----- PROGRESS BAR: linha única e nós centrados ----- */
        /* adicionei apenas a classe `progress-row` no container dos blocos (HTML) e uso este CSS para alinhar */
        .progress-row { position: relative; max-width: 600px; margin: 0 auto; padding: 8px 0; }
        .progress-row::before {
            /* linha de progresso que passa por trás dos nós */
            content: "";
            position: absolute;
            left: 12px;
            right: 12px;
            top: calc(6px + 12px); /* ajusta verticalmente para ficar atrás dos círculos */
            height: 2px;
            background-color: #e5e7eb; /* gray-300 */
            z-index: 1;
        }
        .progress-row .flex {
            position: relative;
            z-index: 2; /* garante que os nós fiquem acima da linha */
            display:flex;
            justify-content: space-between;
            width:100%;
            gap:0;
        }
        .progress-node { display:flex; flex-direction:column; align-items:center; width:64px; } /* mantém espaço consistente */
        .progress-node .dot {
            width: 24px;
            height: 24px;
            border-radius: 9999px;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:12px;
            color:#fff;
            box-shadow: 0 1px 2px rgba(0,0,0,0.06);
        }
        .progress-node .dot.active { background:#FF3B3B; }
        .progress-node .dot.inactive { background:#9CA3AF; } /* gray */
        .progress-node .label { margin-top:6px; font-size:12px; color:#6B7280; font-weight:600; text-align:center; }

        /* Skip label menor (mantive a sua classe .skip-badge para compatibilidade) */
        .skip-badge { background:#FFF3CD; color:#856404; font-weight:700; border-radius:6px; padding:6px 10px; display:inline-flex; align-items:center; gap:8px; font-size:0.75rem; }

        /* Toggle styles (copiado do snippet que você mostrou) */
        .toggle-switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .toggle-input { opacity: 0; width: 0; height: 0; position: absolute; }
        .toggle-label { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #e5e7eb; transition: .25s; border-radius: 999px; }
        .toggle-label::before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .25s; border-radius: 50%; box-shadow: 0 2px 6px rgba(0,0,0,0.08); }
        .toggle-input:checked + .toggle-label { background-color: #3B4151; }
        .toggle-input:checked + .toggle-label::before { transform: translateX(20px); }

        /* disabled state for navigation before exam starts */
        .nav-disabled { pointer-events: none; opacity: 0.45; }
        button[disabled] { opacity: 0.45; cursor: not-allowed; }

        /* Resultados */
        .stats-grid { display:flex; gap:12px; margin-bottom:12px; }
        .block-stats { flex:1; background:#fff; border:1px solid #eef2f7; padding:10px; border-radius:8px; text-align:center; }
        .block-stats .title { font-size:0.85rem; color:#374151; font-weight:700; margin-bottom:6px; }
        .block-stats .value { font-size:1.15rem; font-weight:800; color:#111827; }

        .thumb { max-width:140px; height:auto; border-radius:6px; display:block; margin:6px 0; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.06); }
        details summary { cursor:pointer; padding:8px; border-radius:6px; }

        @media (max-width:720px) {
            .header-rect { flex-direction: column; gap: 12px; }
            .progress-row { max-width:100%; padding:12px 8px; }
            .progress-node { width: 22%; } /* ajuste para mobile */
        }
    </style>
</head>
<body class="bg-[#F8F8F8] min-h-screen flex flex-col justify-between">

    <!-- ===== HEADER (fixo no topo e 100% largura) ===== -->
    <header class="header-rect fixed top-0 left-0 w-full z-50">
        <div class="max-w-[900px] mx-auto flex items-center justify-between px-6 py-4">
            <div class="flex items-center space-x-2">
                <span class="text-gray-800 font-bold text-3xl select-none">InteliDaily</span>
            </div>

            <div class="flex flex-col items-center space-y-1">
                <div class="bg-[#3B4151] text-white text-xs font-semibold rounded px-2 py-[2px] select-none">
                    Início da prova remota: <span class="font-mono" id="start-time">--:--:--</span>
                </div>
                <div class="text-xs text-gray-600 select-none">Tempo para encerrar a prova:</div>
                <div class="font-mono font-semibold text-xl text-gray-900 select-none" id="timer">02:00:00</div>
            </div>

            <div class="flex items-center gap-3">
                <button id="start-exam-btn"
                    class="bg-[#3B4151] text-white text-sm font-semibold rounded px-4 py-2 select-none hover:bg-[#2a2e3d] transition"
                    type="button">Iniciar Prova</button>
                <button id="end-exam-btn"
                    class="bg-[#FF3B3B] text-white text-sm font-semibold rounded px-4 py-2 select-none hover:bg-[#e03232] transition hidden"
                    type="button">Encerrar prova</button>
            </div>
        </div>
    </header>

    <!-- Container principal (com padding-top para não ficar escondido atrás do header fixo) -->
    <div class="max-w-[900px] mx-auto w-full flex flex-col px-4 pt-32 pb-10">

        <!-- ===== Progress bar ===== -->
<section class="mb-6">
<div class="flex items-center justify-between max-w-[600px] mx-auto relative">
  <!-- Linha de fundo (fica atrás) -->
  <div class="absolute top-3 left-0 right-0 mx-auto w-11/12 h-[2px] bg-gray-300 z-0"></div>

  <!-- Bloco 1 -->
  <div class="flex flex-col items-center z-10">
    <div id="block-1"
      class="w-6 h-6 flex items-center justify-center rounded-full bg-[#FF3B3B] text-white text-xs font-bold">
      1
    </div>
    <span class="text-xs font-semibold text-[#FF3B3B] mt-1">Bloco 1</span>
  </div>

  <!-- Bloco 2 -->
  <div class="flex flex-col items-center z-10">
    <div id="block-2"
      class="w-6 h-6 flex items-center justify-center rounded-full bg-gray-400 text-white text-xs font-bold">
      2
    </div>
    <span class="text-xs font-semibold text-gray-600 mt-1">Bloco 2</span>
  </div>

  <!-- Bloco 3 -->
  <div class="flex flex-col items-center z-10">
    <div id="block-3"
      class="w-6 h-6 flex items-center justify-center rounded-full bg-gray-400 text-white text-xs font-bold">
      3
    </div>
    <span class="text-xs font-semibold text-gray-600 mt-1">Bloco 3</span>
  </div>

  <!-- Bloco 4 -->
  <div class="flex flex-col items-center z-10">
    <div id="block-4"
      class="w-6 h-6 flex items-center justify-center rounded-full bg-gray-400 text-white text-xs font-bold">
      4
    </div>
    <span class="text-xs font-semibold text-gray-600 mt-1">Bloco 4</span>
  </div>
</div>
</section>

        <!-- ===== Question navigation and finalize button ===== -->
        <section class="flex flex-wrap items-center justify-between w-full max-w-[900px] mx-auto mb-6">
            <div class="flex items-center space-x-2">
                <div class="flex items-center space-x-1 nav-disabled" id="question-nav">
                    <!-- question bullets inserted by script.js -->
                </div>
                <div class="bg-[#3B4151] text-white text-xs font-semibold rounded px-2 py-1 select-none" style="min-width: 90px" id="answered-count-container">Questões respondidas: <span class="font-bold" id="answered-count">0</span></div>
            </div>

            <button id="finalize-block-btn" class="bg-[#FF3B3B] text-white text-xs font-semibold rounded px-4 py-2 select-none whitespace-nowrap" type="button" disabled>Finalizar Bloco 1</button>
        </section>

        <!-- ===== Question content ===== -->
        <section id="question-content" class="mb-6 max-w-[900px] mx-auto bg-white rounded-md p-6 shadow-sm">
            <h2 class="text-gray-900 font-semibold text-base mb-3 select-none" id="question-title">Questão 01</h2>
            <div class="text-gray-600 text-xs leading-relaxed mb-6 select-text"><!-- Question text will be loaded here --></div>
            <div id="question-images" class="mb-6"><!-- Images will be displayed here --></div>
        </section>

        <!-- Answers -->
        <section id="answer-section" class="max-w-[900px] mx-auto bg-white rounded-md p-6 shadow-sm mb-6">
            <h3 class="text-gray-900 font-semibold text-sm mb-4 select-none">Resposta</h3>
            <form class="space-y-4 text-xs text-gray-700 select-none" id="answer-form"><!-- Answer options will be generated here --></form>

<div class="mt-6">
  <label class="skip-badge cursor-pointer select-none" for="skip-toggle">
    <div class="toggle-switch">
      <input type="checkbox" id="skip-toggle" class="toggle-input" />
      <span class="toggle-label"></span>
    </div>
    <span>Não quero responder esta questão</span>
  </label>
</div>
        </section>

        <!-- Next button -->
        <div class="flex justify-end max-w-[900px] mx-auto">
            <button id="next-btn" class="bg-[#3B4151] text-white text-xs font-semibold rounded px-4 py-2 flex items-center space-x-1 select-none hover:bg-[#2a2e3d] transition" type="button" disabled>
                <span>Próximo</span>
                <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>

    <!-- Results Modal (atualizado: canvas para gráfico e cards por bloco + miniaturas) -->
    <div id="results-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 w-full max-w-4xl mx-4 max-h-[85vh] overflow-y-auto">
            <h2 class="text-2xl font-bold mb-4">Resultados da Prova</h2>

            <div id="results-content">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="bg-green-50 p-4 rounded">
                        <h3 class="font-semibold text-green-800">Acertos</h3>
                        <p class="text-2xl font-bold text-green-600" id="correct-answers-result">0</p>
                    </div>
                    <div class="bg-red-50 p-4 rounded">
                        <h3 class="font-semibold text-red-800">Erros</h3>
                        <p class="text-2xl font-bold text-red-600" id="incorrect-answers-result">0</p>
                    </div>
                </div>

                <!-- Estatísticas por bloco (cards) -->
                <div class="stats-grid mb-4" id="blocks-stats">
                    <div class="block-stats">
                        <div class="title">Bloco 1</div>
                        <div class="value" id="block1-acc">--%</div>
                    </div>
                    <div class="block-stats">
                        <div class="title">Bloco 2</div>
                        <div class="value" id="block2-acc">--%</div>
                    </div>
                    <div class="block-stats">
                        <div class="title">Bloco 3</div>
                        <div class="value" id="block3-acc">--%</div>
                    </div>
                    <div class="block-stats">
                        <div class="title">Bloco 4</div>
                        <div class="value" id="block4-acc">--%</div>
                    </div>
                </div>

                <!-- Gráfico principal de acurácia por bloco -->
                <div class="mb-4">
                    <h4 class="font-semibold text-gray-700 mb-2">Taxa de Acerto por Bloco</h4>
                    <canvas id="accuracy-chart" width="600" height="240"></canvas>
                </div>

                <div class="grid grid-cols-3 gap-4 mb-4">
                    <div class="text-center">
                        <h4 class="font-semibold text-gray-700">Total de Questões</h4>
                        <p class="text-lg font-bold" id="total-questions-result">0</p>
                    </div>
                    <div class="text-center">
                        <h4 class="font-semibold text-gray-700">Respondidas</h4>
                        <p class="text-lg font-bold" id="answered-questions-result">0</p>
                    </div>
                    <div class="text-center">
                        <h4 class="font-semibold text-gray-700">Puladas</h4>
                        <p class="text-lg font-bold" id="skipped-questions-result">0</p>
                    </div>
                </div>

                <div class="mb-6">
                    <h4 class="font-semibold text-gray-700 mb-2">Tempo Utilizado</h4>
                    <p class="text-lg font-bold" id="time-used-result">00:00:00</p>
                </div>

                <div>
                    <h4 class="font-semibold text-gray-700 mb-2">Questões (detalhado)</h4>
                    <div id="wrong-answers-list" class="space-y-2">
                        <!-- Wrong answers will be listed here (minimizado por padrão) -->
                    </div>
                </div>
            </div>

            <div class="mt-6 flex justify-end">
                <button id="close-results-btn" class="bg-[#3B4151] text-white px-4 py-2 rounded font-semibold hover:bg-[#2a2e3d] transition">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Scripts: mantemos inclusão do script principal e adicionamos Chart.js e um pequeno observer para transformar imagens em links (abrir full-size) -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Ao carregar a página adicionamos um observer para as imagens que aparecem no resumo de resultados
        document.addEventListener('DOMContentLoaded', () => {
            const wrongList = document.getElementById('wrong-answers-list');
            if (!wrongList) return;

            const observer = new MutationObserver((mutations) => {
                // Quando o script principal injetar o HTML, transformamos imagens em links para abrir em nova aba
                wrongList.querySelectorAll('img').forEach(img => {
                    if (img.closest('a')) return;
                    try {
                        const src = img.getAttribute('src');
                        const a = document.createElement('a');
                        a.href = src;
                        a.target = '_blank';
                        a.rel = 'noopener noreferrer';
                        img.parentNode.insertBefore(a, img);
                        a.appendChild(img);
                    } catch (e) { /* não bloquear se falhar */ }
                });

                // Atualiza os cards de estatísticas por bloco se o script principal tiver criado os números
                try {
                    const b1 = document.getElementById('block1-acc');
                    const b2 = document.getElementById('block2-acc');
                    const b3 = document.getElementById('block3-acc');
                    const b4 = document.getElementById('block4-acc');
                    const totals = Array.from(document.querySelectorAll('#accuracy-chart')).length; // (apenas trigger)
                    // nada a fazer aqui diretamente; os valores são preenchidos pelo script.js no momento de finalizar
                } catch (e) {}
            });
            }

        })();
    </script>
</body>
</html>
